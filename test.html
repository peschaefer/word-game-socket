<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <input type="text" id="usernameInput" placeholder="Type a username" value="Peyton">
    <input type="text" id="roomCodeInput" placeholder="Type a room code">
    <input type="text" id="promptInput" placeholder="Type your answer here" class="hidden" value="ants">
    <button onclick="joinRoom(document.getElementById('roomCodeInput').value)">Join Room</button>
    <button onclick="createRoom()">Create Room</button>
    <button onclick="requestGameStart(document.getElementById('roomCodeInput').value)">Start Game</button>
    <button onclick="submitResponse(document.getElementById('promptInput').value, document.getElementById('roomCodeInput').value)">Submit</button>
    <pre id="messages"></pre>
    <script>
        const ws = new WebSocket('ws://localhost:8080/ws');
        let playing = false;

        ws.onopen = () => {
            console.log('WebSocket connection established');
        };

        ws.onmessage = (event) => {
            const messages = document.getElementById('messages');
            messages.textContent += `Received: ${event.data}\n`;
            const response = JSON.parse(event.data)

            if(response.type === "game-created"){
                document.getElementById("roomCodeInput").value = response.content.room_code
            }

            switch(response.type){
                case "game-created": joinRoom(response.content.room_code)
                    return
                case "round-completed": endRound();
                    return
                case "game-started": startGame()
                    return
                case "joined-game": localStorage.setItem("userId", response.content.user_id);
                    return
                case "game-started": document.getElementById("promptInput").classList.toggle("hidden")
            }
        };

        ws.onerror = () => {
            console.log('WebSocket connection failed');
        }

        function createRoom() {
            const roomCode = document.getElementById('roomCodeInput');
            const username = document.getElementById('usenameInput');

            let message = { type: 'create-game', content: "" };
            console.log(message);
            ws.send(JSON.stringify(message));
        }

        function joinRoom(roomCode) {
            const username = document.getElementById('usernameInput').value;
            const message = { type: 'join-game', content: {room_code: roomCode, username: username} };
            console.log(message);
            ws.send(JSON.stringify(message));
        }

        function requestGameStart(roomCode) {
            const message = { type: 'start-game', content: {room_code: roomCode} };
            console.log(message);
            ws.send(JSON.stringify(message));
        }

        function endRound(){
            document.getElementById('promptInput').classList.toggle('hidden')
        }

        function startGame(){
            playing = true
            document.getElementById('promptInput').classList.toggle('hidden')
        }

        function submitResponse(answer, roomCode){
            const id = localStorage.getItem("userId");
            const message = { type: 'submit-answer', content: {room_code: roomCode, answer: answer, player_id: id}}
            ws.send(JSON.stringify(message))
        }
    </script>
</body>
<style>
    .good{
        background-color: green;
    }

    .bad{
        background-color: red;
    }

    .websocket-status{
        height: 100px;
        width: 100%;
    }

    .hidden{
        display: none;
    }
</style>
</html>
