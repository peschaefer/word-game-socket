<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <input type="text" id="usernameInput" placeholder="Type a username">
    <input type="text" id="roomCodeInput" placeholder="Type a room code">
    <button onclick="joinRoom(document.getElementById('roomCodeInput').value)">Join Room</button>
    <button onclick="createRoom()">Create Room</button>
    <button onclick="startGame(document.getElementById('roomCodeInput').value)">Start Game</button>
    <pre id="messages"></pre>
    <script>
        const ws = new WebSocket('ws://localhost:8080/ws');

        ws.onopen = () => {
            console.log('WebSocket connection established');
        };

        ws.onmessage = (event) => {
            const messages = document.getElementById('messages');
            messages.textContent += `Received: ${event.data}\n`;
            const response = JSON.parse(event.data)

            if(response.type === "game-created"){
                document.getElementById("roomCodeInput").value = response.content.room_code
            }

            switch(response.type){
                case "game-created": joinRoom(response.content.room_code)
            }
        };

        ws.onerror = () => {
            //document.getElementById("websocket-status").classList.toggle("bad")
            //document.getElementById("websocket-status-message").innerText = "Connection Failed"
            console.log('WebSocket connection failed');
        }

        function createRoom() {
            const roomCode = document.getElementById('roomCodeInput');
            const username = document.getElementById('usenameInput');

            let message = { type: 'create-game', content: "" };
            console.log(message);
            ws.send(JSON.stringify(message));

            // message = { type: 'add-player', content: {room_code: roomCode, username: username} };
            // ws.send(JSON.stringify(message));
        }

        function joinRoom(roomCode) {
            const username = document.getElementById('usernameInput').value;

            const message = { type: 'join-game', content: {room_code: roomCode, username: username} };
            console.log(message);
                ws.send(JSON.stringify(message));
        }

        function startGame(roomCode) {
            const username = document.getElementById('usernameInput').value;

            const message = { type: 'start-game', content: {room_code: roomCode} };
            console.log(message);
            ws.send(JSON.stringify(message));
        }
    </script>
</body>
<style>
    .good{
        background-color: green;
    }

    .bad{
        background-color: red;
    }

    .websocket-status{
        height: 100px;
        width: 100%;
    }
</style>
</html>
